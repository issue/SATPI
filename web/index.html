<!doctype html>
<html data-bs-theme="light">
  <head>
    <meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
		<title>SAT>IP Main Web Page</title>
		<link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/stylesheet.css" rel="stylesheet">
		<script src="assets/dist/js/jquery.min.js"></script>
    <script src="assets/dist/js/bootstrap.bundle.min.js"></script>
		<script src="assets/js/loadxmldoc.js"></script>
		<script>
		function stopSatPI() { $('#StopDialog').modal(); }
		function restartSatPI() { $('#RestartDialog').modal(); }
		// ajax refresh callback
		function updatePage() {
			loadXMLDoc("SatPI.xml");
		}
		function updateEntry(infopage, xmlValue) {
			if (infopage.innerHTML != xmlValue.innerHTML) {
				infopage.innerHTML = xmlValue.innerHTML;
			}
		}
		// function called when xml is loaded
		function onXMLLoaded(xml) {
			appdata = xml.getElementsByTagName('appdata');
			ssdpdata = xml.getElementsByTagName('ssdp');
			configdata = xml.getElementsByTagName('configdata');

			let uptime = appdata[0].getElementsByTagName('uptime')[0].innerHTML;

			let sec = uptime % 60;
			let min = Math.round((uptime/60) - 0.5);
			let hours = Math.round((min/60) - 0.5);
			let days = Math.round((hours/24) - 0.5);
			min -= (hours * 60);
			hours -= (days * 24);

			let InfoPage = document.getElementById('InfoPage');
			InfoPage.rows[1].cells[1].innerHTML = days + ' days ' + hours + ' hours ' + min + ' min ' + sec + ' sec';

			updateEntry(InfoPage.rows[0].cells[1], appdata[0].getElementsByTagName('appversion')[0]);
			updateEntry(InfoPage.rows[2].cells[1], appdata[0].getElementsByTagName('uuid')[0]);
			updateEntry(InfoPage.rows[3].cells[1], ssdpdata[0].getElementsByTagName('bootID')[0]);
			updateEntry(InfoPage.rows[4].cells[1], ssdpdata[0].getElementsByTagName('deviceID')[0]);
			updateEntry(InfoPage.rows[5].cells[1], ssdpdata[0].getElementsByTagName('ttl')[0]);
			updateEntry(InfoPage.rows[6].cells[1], configdata[0].getElementsByTagName('ipaddress')[0].getElementsByTagName('value')[0]);
			updateEntry(InfoPage.rows[7].cells[1], configdata[0].getElementsByTagName('bindipaddress')[0].getElementsByTagName('value')[0]);
			updateEntry(InfoPage.rows[8].cells[1], configdata[0].getElementsByTagName('rtspport')[0].getElementsByTagName('value')[0]);

			if (InfoPage.rows[9].cells[1].innerText == "...") {
				let ip = configdata[0].getElementsByTagName('ipaddress')[0].getElementsByTagName('value')[0].innerHTML;
				let port = configdata[0].getElementsByTagName('httpport')[0].getElementsByTagName('value')[0].innerHTML;
				let xmldesc = configdata[0].getElementsByTagName('xmldesc')[0].getElementsByTagName('value')[0].innerHTML;
				let link = 'http://' + ip + ':' + port + '/' + xmldesc;
				InfoPage.rows[9].cells[1].innerHTML = '<a href="' + link + '" class="btn-info btn-sm" role="button">Show</a>';
			}
		}
		var refresh_time = 2000;
		updatePage();
		setInterval('updatePage()', refresh_time);
</script>

  </head>
  <body>

<header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
  <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" href="#">SatPI</a>
  <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  </div>
</header>

<div class="container-fluid">
  <div class="row">
    <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
      <div class="position-sticky pt-3">
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="index.html">
              <span class="bi bi-house-fill" data-feather="home"></span>
              Server Info
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="log.html">
              <span class="bi bi-list-columns" data-feather="log"></span>
							Log
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="frontendoverview.html">
              <span class="bi bi-binoculars-fill" data-feather="frontend-overview"></span>
              Frontend Overview
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="frontend.html#">
              <span class="bi bi-list" data-feather="frontend"></span>
							Frontend
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="config.html">
              <span class="bi bi-gear-wide-connected" data-feather="configure"></span>
							Configure
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="contact.html">
              <span class="bi bi-person-vcard-fill" data-feather="contact"></span>
							Contact
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="about.html">
              <span class="bi bi-info-circle-fill" data-feather="about"></span>
							About
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/Barracuda09/SATPI/wiki" target="_blank" rel="noopener noreferrer">
              <span class="bi bi-wikipedia" data-feather="wiki"></span>
							Wiki
            </a>
          </li>
        </ul>
    </nav>

    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Server Info</h1>
      </div>
	<!-- Stop Dialog -->
	<div class="modal fade" id="StopDialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title">Stop SatPI Server?</h4>
					<button type="button" class="close" data-dismiss="modal">×</button>
				</div>
				<div class="modal-body">
					Are you sure?
				</div>

				<!-- Modal footer -->
				<div class="modal-footer">
					<a href="STOP" class="btn btn-danger" role="button">Yes</a>
					<button type="button" class="btn btn-success" data-dismiss="modal">No</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Restart Dialog -->
	<div class="modal fade" id="RestartDialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title">Restart SatPI Server?</h4>
					<button type="button" class="close" data-dismiss="modal">×</button>
				</div>
				<div class="modal-body">
					Are you sure?
				</div>

				<!-- Modal footer -->
				<div class="modal-footer">
					<a href="RESTART" class="btn btn-danger" role="button">Yes</a>
					<button type="button" class="btn btn-success" data-dismiss="modal">No</button>
				</div>
			</div>
		</div>
		</div>
      <div class="table-responsive">
				<table id="InfoPage" class="table table-bordered table-sm">
					<tr><td class=\"col-xs-1\">Version</td><td class="col-xs-2">...</td> </tr>
					<tr><td class=\"col-xs-1\">Uptime</td><td class="col-xs-2">...</td> </tr>
					<tr><td class=\"col-xs-1\">UUID</td><td class="col-xs-2">...</td> </tr>
					<tr><td class=\"col-xs-1\">Boot ID</td><td class="col-xs-2">...</td> </tr>
					<tr><td class=\"col-xs-1\">Device ID</td><td class="col-xs-2">...</td> </tr>
					<tr><td class=\"col-xs-1\">SSDP TTL</td><td class="col-xs-2">...</td> </tr>
					<tr><td class=\"col-xs-1\">IP Address</td><td class="col-xs-2">...</td> </tr>
					<tr><td class=\"col-xs-1\">Bind IP Address</td><td class="col-xs-2">...</td> </tr>
					<tr><td class=\"col-xs-1\">RTSP Port</td><td class="col-xs-2">...</td> </tr>
					<tr><td class=\"col-xs-1 \">Satip Description XML</td><td class="col-xs-2">...</td> </tr>
				</table>
      </div>
    </main>
  </div>
</div>
  </body>
</html>
